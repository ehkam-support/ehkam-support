<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>مساعد إحكام — دعم فني</title>
  <style>
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Naskh Arabic", Tahoma, sans-serif; background:#f6f7fb; color:#111; }
    header { position:sticky; top:0; background:#fff; border-bottom:1px solid #eee; }
    .wrap { max-width: 920px; margin:0 auto; padding: 12px; }
    h1 { margin:0; font-size: 18px; }
    #chat { height: calc(100vh - 210px); overflow-y:auto; padding: 16px 6px 8px; }
    .msg { display:flex; gap:10px; margin:10px 0; align-items:flex-start; }
    .bubble { padding: 10px 14px; border-radius:14px; max-width:85%; line-height:1.7; white-space:pre-wrap; word-wrap:break-word; }
    .user .bubble { background:#0077ff; color:#fff; border-bottom-left-radius:4px; margin-inline-start:auto; }
    .bot  .bubble { background:#fff; border:1px solid #eee; border-bottom-right-radius:4px; }
    .menu { display:flex; flex-direction:column; gap:8px; margin-top:8px; }
    .menu button { width:100%; text-align:right; border:1px solid #ddd; background:#fff; padding:12px 14px; border-radius:10px; cursor:pointer; font:inherit; }
    .menu button:hover { border-color:#bbb; }
    form { position:sticky; bottom:0; background:#fff; border-top:1px solid #eee; }
    .row { display:flex; gap:8px; align-items:stretch; }
    textarea { flex:1; resize:none; min-height:44px; max-height:140px; padding:10px 12px; border:1px solid #ddd; border-radius:10px; font:inherit; }
    button.send { padding:0 16px; border:1px solid #0077ff; background:#0077ff; color:#fff; border-radius:10px; cursor:pointer; font:inherit; }
    .hint { font-size:12px; color:#666; margin-top:6px; }
    footer { text-align:center; font-size:12px; color:#888; padding:8px 0 14px; }
    a { color:#0077ff; }
    .center { display:flex; gap:8px; flex-wrap:wrap; }
    .center button { flex:1; min-width:110px; }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>مساعد إحكام — دعم فني</h1>
    </div>
  </header>

  <div class="wrap">
    <div id="chat" aria-live="polite" aria-label="منطقة المحادثة"></div>
  </div>

  <form id="composer" autocomplete="off">
    <div class="wrap">
      <div class="row">
        <textarea id="input" placeholder="كيف أساعدك؟"></textarea>
        <button class="send" id="send" type="submit">إرسال</button>
      </div>
      <div class="hint">تلميح: اكتب رقم الخدمة (1–5) أو اضغط الزر.</div>
    </div>
  </form>

  <footer>
    <div class="wrap">صفحة واحدة — دعم فني ثابت لمنصة إحكام</div>
  </footer>

  <script>
  (function () {
    // ====== نص الترحيب (المربع الأول) ======
    const GREET_BOX = [
      "مرحبًا",
      "أنا مساعدك بمنصة إحكام",
      "يسعدني تقديم الخدمات والإجابات على كافة أسئلتك"
    ].join("\n");

    // ====== عنوان المربع الثاني ======
    const QUESTION_TITLE = "ما الخدمة التي تريد الاستفسار عنها";

    // ====== الردود ======
    const REPLIES = {
      "1": يمكنك متابعة طلبك عن طريق منصة إحكام أو التواصل مع مركز الاتصال الموحد/920035544 أو إرسال بريد إلكتروني على البريد الرسمي info@ehkaam.sa,
      "2": مراجعة فرع الهيئة بالمنطقة المتواجد فيها برفقة المستندات المطلوبة ليتم رفع استدعاء من قبل موظف خدمة العملاء بفرع الهيئة عن طريق نظام معاملات.,
      "3": `يمكنك التوجه لأقرب فرع للهيئة العامة لعقارات الدولة بالمنطقة مع إحضار المستندات التالية:
1- وكالة من جميع الورثة (مذكور بها مراجعة هيئة عقارات الدولة)
2- صك حصر الورثة
3- شهادة الوفاة
4- البطاقة الشخصية
5- كتاب معروض موجه لمدير الفرع لطلب النقل
6- وجود حساب للموكل بمنصة إحكام`,
      "4": `بشأن استرداد رسوم لمستفيدي الضمان الاجتماعي:
1- البطاقة الشخصية
2- مشهد من الضمان الاجتماعي
3- التوجه لفرع الهيئة العامة لعقارات الدولة بفرع المنطقة.`,
      "5": `يمكنك الاستعلام عن المعاملات من خلال الرابط التالي:
https://spga.gov.sa/Enquiry-Service`
    };

    // ====== قائمة الخدمات (أزرار رأسية) ======
    const MENU = [
      { key:"1", label:"1- استفسار عن طلب تملك" },
      { key:"2", label:"2- بشأن تسليم وثائق مطلوبة منك من منصة إحكام" },
      { key:"3", label:"3- بشأن نقل طلبات من مورث إلى أحد الورثة" },
      { key:"4", label:"4- بشأن استرداد رسوم لمستفيدي الضمان الاجتماعي" },
      { key:"5", label:"5- استعلام عن المعاملات" }
    ];

    // ====== عناصر DOM ======
    let chat, form, input;

    // ====== أدوات صغيرة ======
    function el(tag, attrs = {}, ...children) {
      const e = document.createElement(tag);
      for (const [k, v] of Object.entries(attrs)) {
        if (k === "class") e.className = v;
        else if (k.startsWith("on") && typeof v === "function") e.addEventListener(k.slice(2), v);
        else e.setAttribute(k, v);
      }
      for (const c of children) {
        if (c == null) continue;
        e.appendChild(typeof c === "string" ? document.createTextNode(c) : c);
      }
      return e;
    }

    function addBubble(role, text) {
      const row = el("div", { class: "msg " + (role === "user" ? "user" : "bot") });
      const bubble = el("div", { class: "bubble" }, text);
      row.appendChild(bubble);
      chat.appendChild(row);
      chat.scrollTop = chat.scrollHeight;
    }

    // ====== صناديق البداية ======
    function showFirstBox() { addBubble("bot", GREET_BOX); }

    function showSecondBox() {
      const row = el("div", { class: "msg bot" });
      const bubble = el("div", { class: "bubble" });
      bubble.appendChild(el("div", {}, QUESTION_TITLE + " :"));
      const menu = el("div", { class: "menu" });
      for (const item of MENU) {
        const btn = el("button", { type:"button", onclick: () => handleChoice(item.key) }, item.label);
        menu.appendChild(btn);
      }
      bubble.appendChild(menu);
      row.appendChild(bubble);
      chat.appendChild(row);
      chat.scrollTop = chat.scrollHeight;
    }

    function restartFlow() {
      showFirstBox();
      showSecondBox();
    }

    // ====== بعد الرد: هل يريد خدمة أخرى؟ ======
    function askAnother() {
      const row = el("div", { class: "msg bot" });
      const bubble = el("div", { class: "bubble" });
      bubble.appendChild(el("div", {}, "هل تريد خدمة أخرى؟"));
      const rowBtns = el("div", { class: "center", style:"margin-top:8px" });
      const yes = el("button", { type:"button", onclick: ()=>{ addBubble("user","نعم"); restartFlow(); } }, "نعم");
      const yes2 = el("button", { type:"button", onclick: ()=>{ addBubble("user","إي"); restartFlow(); } }, "إي");
      const no  = el("button", { type:"button", onclick: ()=>{ addBubble("user","لا"); addBubble("bot","سعدنا بخدمتكم"); } }, "لا");
      rowBtns.appendChild(yes); rowBtns.appendChild(yes2); rowBtns.appendChild(no);
      bubble.appendChild(rowBtns);
      row.appendChild(bubble);
      chat.appendChild(row);
      chat.scrollTop = chat.scrollHeight;
    }

    // ====== عند اختيار خدمة ======
    function handleChoice(key) {
      const item = MENU.find(m => m.key === key);
      if (!item) return;
      addBubble("user", item.label);
      addBubble("bot", REPLIES[key]);
      askAnother();
    }

    // ====== كتابة نص حر ======
    function handleFreeText(txt) {
      const t = txt.trim();
      // أرقام 1..5 (عربي/إنجليزي)
      if (/^[١-٥1-5]$/.test(t)) {
        const map = { "1":"1","2":"2","3":"3","4":"4","5":"5","١":"1","٢":"2","٣":"3","٤":"4","٥":"5" };
        handleChoice(map[t]); return;
      }
      // نعم/إي
      if (/^(نعم|اي|إي|ايوه|أيوه|yes)$/i.test(t)) { restartFlow(); return; }
      // لا
      if (/^(لا|no)$/i.test(t)) { addBubble("bot","سعدنا بخدمتكم"); return; }

      // غير ذلك
      addBubble("bot","يرجى اختيار رقم خدمة من (1–5) أو الضغط على أحد الأزرار بالأسفل.");
      showSecondBox();
    }

    // ====== تهيئة بعد تحميل الصفحة ======
    function init() {
      chat = document.getElementById("chat");
      form = document.getElementById("composer");
      input = document.getElementById("input");

      form.addEventListener("submit", (e) => {
        e.preventDefault();
        const txt = (input.value || "").trim();
        if (!txt) return;
        addBubble("user", txt);
        input.value = "";
        handleFreeText(txt);
      });

      // ابدأ بالمربع الأول ثم الثاني
      restartFlow();
    }

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", init);
    } else {
      init();
    }
  })();
  </script>
</body>
</html>
